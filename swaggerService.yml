openapi: 3.0.3
info:
  title: Fake News Detection API
  version: 1.1.0
  description: |
    Service to classify articles as FAKE or REAL using multiple model strategies (TF-IDF, Embeddings, Late Fusion).
    Provides token-level explanations using LIME or SHAP (based on TF-IDF features).
    Supports optional automatic translation.
  contact:
    name: Shlomi Assayag
    email: shlomiasi1@gmail.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://127.0.0.1:8000
    description: Local development server

tags:
  - name: article
    description: Classify an article and get token-level explanation

paths:
  /api/predict:
    post:
      tags:
        - article
      summary: Classify article text with selected model and explanation
      operationId: classifyArticle
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PredictRequest'
            examples:
              fusion_example:
                summary: Late Fusion prediction
                value:
                  text: "Abu Maazen in 2025 still hates Israel and wants to meet with Iran to destroy them"
                  top_k: 15
                  translate: false
                  model: "fusion"
                  explainer: "lime"
      responses:
        '200':
          description: Classification result with explanation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictResponse'
              examples:
                success_fusion:
                  value:
                    label: "FAKE"
                    prob_fake: 0.985
                    model_used: "fusion"
                    prob_fake_tfidf: 0.92
                    prob_fake_emb: 0.99
                    top_tokens:
                      - token: "2025"
                        weight: 0.45
                        towards: "FAKE"
                      - token: "destroy"
                        weight: 0.12
                        towards: "FAKE"
                    explainer: "lime"
                    translation:
                      enabled: true
                      did_translate: false
                      src_lang: "en"
                      tgt_lang: "en"
        '400':
          description: Bad request (e.g., missing text)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error (e.g., model missing)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    PredictRequest:
      type: object
      required: [text]
      properties:
        text:
          type: string
          minLength: 1
          description: The article content to classify
        top_k:
          type: integer
          minimum: 1
          maximum: 100
          default: 15
          description: Number of influential tokens to return
        translate:
          type: boolean
          default: false
          description: Whether to automatically translate text
        target_lang:
          type: string
          default: "en"
          description: Target language code if translate=true
        explainer:
          type: string
          default: "lime"
          enum: [lime, shap]
          description: Choice of explainer method
        model:
          type: string
          default: "tfidf"
          enum: [tfidf, emb, fusion]
          description: "Model strategy: 'tfidf' (Classic), 'emb' (Embeddings), or 'fusion' (Late Fusion)"

    PredictResponse:
      type: object
      properties:
        label:
          type: string
          enum: [FAKE, REAL]
          description: Final classification label
        prob_fake:
          type: number
          format: float
          description: Final probability assigned to FAKE (0.0 to 1.0)
        model_used:
          type: string
          enum: [tfidf, emb, fusion]
          description: The model strategy actually used
        prob_fake_tfidf:
          type: number
          format: float
          nullable: true
          description: Raw probability from the TF-IDF model (may be null if not used/calculated)
        prob_fake_emb:
          type: number
          format: float
          nullable: true
          description: Raw probability from the Embedding model (may be null if not used/calculated)
        top_tokens:
          type: array
          description: Token-level contributions (always based on TF-IDF features)
          items:
            $ref: '#/components/schemas/TokenWeight'
        explainer:
          type: string
          enum: [lime, shap]
          description: Explainer used
        translation:
          $ref: '#/components/schemas/TranslationInfo'

    TokenWeight:
      type: object
      required: [token, weight, towards]
      properties:
        token:
          type: string
          description: Token text
        weight:
          type: number
          format: float
          description: Contribution weight
        towards:
          type: string
          enum: [FAKE, REAL]
          description: Direction the token pushes the decision

    TranslationInfo:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether translation is enabled on the server
        did_translate:
          type: boolean
          description: Whether the text was actually translated
        src_lang:
          type: string
          nullable: true
          description: Detected source language
        tgt_lang:
          type: string
          nullable: true
          description: Target language used

    Error:
      type: object
      required: [message]
      properties:
        error:
          type: string
          description: Error details
