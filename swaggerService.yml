openapi: 3.0.4
info:
  title: Fake News Detection API
  version: 1.0.0
  description: |
    Service to classify articles as FAKE or REAL and provide token-level explanations.
    Supports LIME and SHAP explainers and optional automatic translation.
  contact:
    name: Shlomi Assayag
    email: shlomiasi1@gmail.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://127.0.0.1:8000
    description: Local development server

tags:
  - name: article
    description: Classify an article and get token-level explanation

paths:
  /api/predict:
    post:
      tags:
        - article
      summary: Classify article text as FAKE/REAL with token-level explanation
      operationId: classifyArticle
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PredictRequest'
            examples:
              basic:
                value:
                  text: "זהו טקסט לדוגמה לבדיקה"
                  top_k: 20
                  translate: true
                  target_lang: "en"
                  explainer: "lime"
      responses:
        '200':
          description: Classification result with explanation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictResponse'
              examples:
                ok:
                  value:
                    label: "FAKE"
                    prob_fake: 0.734
                    top_tokens:
                      - token: "חדשות"
                        weight: 0.182
                        towards: "FAKE"
                      - token: "טוב"
                        weight: -0.041
                        towards: "REAL"
                    explainer: "lime"
                    translation:
                      enabled: true
                      did_translate: true
                      src_lang: "iw"
                      tgt_lang: "en"
        '400':
          description: Bad request (e.g., missing text)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingText:
                  value:
                    code: "bad_request"
                    message: "missing 'text'"
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    PredictRequest:
      type: object
      required: [text]
      properties:
        text:
          type: string
          minLength: 1
          description: The article content to classify
        top_k:
          type: integer
          minimum: 1
          maximum: 100
          default: 15
          description: Number of influential tokens to return
        translate:
          type: boolean
          default: false
          description: Whether to automatically translate text
        target_lang:
          type: string
          default: "en"
          description: Target language code if translate=true
        explainer:
          type: string
          default: "lime"
          enum: [lime, shap]
          description: Choice of explainer method

    PredictResponse:
      type: object
      properties:
        label:
          type: string
          enum: [FAKE, REAL]
          description: Final classification
        prob_fake:
          type: number
          format: float
          description: Probability assigned to FAKE
        top_tokens:
          type: array
          description: Token-level contributions
          items:
            $ref: '#/components/schemas/TokenWeight'
        explainer:
          type: string
          enum: [lime, shap]
          description: Explainer used
        translation:
          $ref: '#/components/schemas/TranslationInfo'

    TokenWeight:
      type: object
      required: [token, weight, towards]
      properties:
        token:
          type: string
          description: Token text
        weight:
          type: number
          format: float
          description: Contribution weight
        towards:
          type: string
          enum: [FAKE, REAL]
          description: Direction the token pushes the decision

    TranslationInfo:
      type: object
      properties:
        enabled:
          type: boolean
          description: Whether translation is enabled on the server
        did_translate:
          type: boolean
          description: Whether the text was actually translated
        src_lang:
          type: string
          nullable: true
          description: Detected source language
        tgt_lang:
          type: string
          nullable: true
          description: Target language used

    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string
